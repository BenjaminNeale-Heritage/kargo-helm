
# GitOps Config

## Trunk Directory Structure
This is the directory structure under the trunk (AKA "main" branch).

### Overview
```
cluster-config/
├─ components/
│  ├─ {COMPONENT_NAME}/
│  │  ├─ helm/
│  │  │  ├─ overlays/
│  │  │  │  ├─ {CLUSTER_NAME}/
│  │  │  │  │  └─ values.yaml
│  │  │  │  └─ ...
│  │  │  └─ Standard Helm chart file structure ( https://helm.sh/docs/topics/charts/ ).
│  │  └─ resources/
│  │     ├─ base/
│  │     ├─ overlays/
│  │     │  ├─ {CLUSTER_NAME}/
│  │     │  │  └─ ...
│  │     │  └─ ...
│  └─ ...
└─ ...
```

### Explanation

#### Structure
* The "components" root directory contains the configuration for each component.  The "_base_" and "_overlays_" directories for Kustomize are located here as well as any configuration managed through a Helm chart.  Policies to manage the component are also defined here.
* Helm configuration common to all clusters should be put into the "components/{COMPONENT_NAME}/helm/values.yaml" file.
* Helm configuration for a single cluster should be put into the "components/{COMPONENT_NAME}/helm/overlays/{CLUSTER_NAME}/values.yaml" file.  This file will be the Helm starting point for rendering manifests into a sub-directory of the "resources/" directory in the respective "cluster/{CLUSTER_NAME}" branch (refer below).

#### File Naming
* All YAML files must end in the .yaml file extension. Files with the .yml file extension will be ignored by Git.
* The 'base' resource manifest file can just be named after the resource manifest (e.g. "deployment.yaml" can be the 'base' name file for a `Deployment` resource manifest).  The 'base' resource manifest file can also have a descriptive suffix if there are more than one of the same kind of resource manifest file within the same directory (e.g. there might be two `MachineSet` resource manifest files in the same directory which may be called "machineset-infra.yaml" and "machineset-worker.yaml").
* All files for resource manifest patches must start with the name of the resource manifest as the prefix and must also have a descriptive suffix (e.g. a patch for a `Deployment` resource manifest that changes the replicas might be named "deployment-replicas.yaml").

## Rendered Manifest Directory Structure
This is the directory structure under a "cluster/{CLUSTER_NAME}" branch generated by Kargo Render.

### Overview
```
cluster-config/
├─ components/
│  ├─ {COMPONENT_NAME}/
│  └─ ...
```

### Explanation

#### Structure
* The "components" root directory is referenced by an Argo CD ApplicationSet.  Every sub-directory will be created as a separate Argo CD Application.
